name: duragraph
region: nyc

services:
  - name: api
    dockerfile_path: deploy/docker/Dockerfile.server
    github:
      repo: your-org/duragraph
      branch: main
      deploy_on_push: true
    http_port: 8080
    instance_count: 1
    instance_size_slug: basic-xxs
    health_check:
      http_path: /health
      initial_delay_seconds: 10
      period_seconds: 30
      timeout_seconds: 5
      success_threshold: 1
      failure_threshold: 3
    envs:
      - key: PORT
        value: "8080"
      - key: HOST
        value: "0.0.0.0"
      - key: DB_HOST
        value: ${db.HOSTNAME}
      - key: DB_PORT
        value: ${db.PORT}
      - key: DB_USER
        value: ${db.USERNAME}
      - key: DB_PASSWORD
        value: ${db.PASSWORD}
      - key: DB_NAME
        value: ${db.DATABASE}
      - key: DB_SSLMODE
        value: "require"
      - key: NATS_URL
        value: "nats://nats:4222"
      - key: OPENAI_API_KEY
        scope: RUN_TIME
        type: SECRET
      - key: ANTHROPIC_API_KEY
        scope: RUN_TIME
        type: SECRET
      - key: JWT_SECRET
        scope: RUN_TIME
        type: SECRET
      - key: AUTH_ENABLED
        value: "false"

  - name: nats
    image:
      registry_type: DOCKER_HUB
      registry: nats
      repository: nats
      tag: 2.10-alpine
    instance_count: 1
    instance_size_slug: basic-xxs
    internal_ports:
      - 4222
      - 8222
    command:
      - "-js"
      - "-sd"
      - "/data"
      - "-m"
      - "8222"
    health_check:
      http_path: /healthz
      port: 8222
      initial_delay_seconds: 5
      period_seconds: 10
      timeout_seconds: 3

  - name: dashboard
    dockerfile_path: deploy/docker/Dockerfile.dashboard
    github:
      repo: your-org/duragraph
      branch: main
      deploy_on_push: true
    http_port: 80
    instance_count: 1
    instance_size_slug: basic-xxs
    routes:
      - path: /dashboard

databases:
  - name: db
    engine: PG
    version: "15"
    production: false
    cluster_name: duragraph-db
