name: Conformance Tests

on:
  push:
    branches: [ "main" ]
  pull_request:

jobs:
  conformance:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Start services with Docker Compose
        run: docker compose -f deploy/compose/docker-compose.test.yml up -d --build --wait test-api

      - name: Run Conformance Tests
        run: docker compose -f deploy/compose/docker-compose.test.yml run --rm test-runner

      - name: Shutdown Docker Compose
        if: always()
        run: docker compose -f deploy/compose/docker-compose.test.yml down -v
